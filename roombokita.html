<!DOCTYPE html>
<html>
<head>
    <title>Roomba CONTROL</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/js/materialize.min.js"></script>
    <script src="/node_modules/jquery/dist/jquery.min.js"></script>
    <script src="node_modules/socket.io-client/dist/socket.io.min.js"></script>
</head>
<body>
  <div class="container">
    <nav class="nav-extended green">
      <div class="nav-wrapper">
        <a href="roombokita.html" class="brand-logo center"><img id="logo" src="img/roomba2.jpg" width="30px">RoombOkita Control</a>
      </div>
      <div class="nav-content green">
        <ul class="tabs tabs-transparent">
          <li class="tab"><a class="active" href="#manualControl">Manual Control</a></li>
          <li id="tab2" class="tab disabled"><a href="#mereBelief">Mere Belief Answers</a></li>
        </ul>
      </div>
      </nav>
      <!-- FIRST TAB  -->
      <div id="connectMsg" class="col s12 m7">
        <div class="card horizontal">
          <div class="card-image">
            <img src="http://lorempixel.com/100/190/nature/6">
          </div>
          <div class="card-stacked">
            <div class="card-content">
              <p>Server is down! Boot server and reload page!</p>
            </div>
            <div class="card-action">
              <a href="">Reload Page</a>
            </div>
          </div>
        </div>
      </div>
      <div id="manualControl" class="col s10">
        <div class="section">
          <h4 class="purple-text text-darken-3 center-align">Manual Control</h4>
          <div class="row">
            <div class="col s12 center">
              <a id="connect" class="waves-effect waves-light btn-large green lighten-2" onclick = "clientConnect()"><i class="material-icons left">settings_input_antenna</i>Connect to Roomba</a>
              <div>STATUS: <span id="status">Disconnected</span><img id="greenLight" class="light" src="img/green_light.png" alt=""><img id="redLight"class="light" src="img/red_light.png" alt=""></div>
            </div>
          </div>
            <div id="controls">
              <div class="row">
                <div class="col s12">
                  <h5 class="purple-text text-darken-3 center-align">Movement Control</h5>
                  <div class="grid-container">
                    <div class="grid">
                      <a id="rotateLeft" class="btn-floating btn-large waves-effect waves-light green"><i class="material-icons">replay</i></a>
                      <a id="forward" class="btn-floating btn-large waves-effect waves-light orange lighten-1"><i class="material-icons">keyboard_arrow_up</i></a>
                      <a id="rotateRight" class="btn-floating btn-large waves-effect waves-light green"><i class="material-icons">replay</i></a>
                      <div class="cell"></div>
                      <img id="logo2" src="img/roomba2.jpg" width="50px" height="50px">
                      <div class="cell"></div>
                      <div class="cell"></div>
                      <a id="back" class="btn-floating btn-large waves-effect waves-light orange lighten-1"><i class="material-icons">keyboard_arrow_down</i></a>
                      <div class="cell"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- SECOND TAB  -->
      <div id="mereBelief" class="col s12">
        <div class="section">
          <h4 class="purple-text text-darken-3 center-align">Mere Belief Answers</h4>
          <div class="row">
            <div class="col s12 center">
              <a class="waves-effect waves-purple btn-large  orange lighten-1 answer" onclick= "answerClient(1)"><i class="material-icons left">play_arrow</i>Answer 1</a>
              <a class="waves-effect waves-purple btn-large  orange lighten-1 answer" onclick= "answerClient(2)"><i class="material-icons left">play_arrow</i>Answer 2</a>
              <a class="waves-effect waves-purple btn-large  orange lighten-1 answer" onclick= "answerClient(3)"><i class="material-icons left">play_arrow</i>Answer 3</a>
              <a class="waves-effect waves-purple btn-large  orange lighten-1 answer" onclick= "answerClient(4)"><i class="material-icons left">play_arrow</i>Answer 4</a>
              <a class="waves-effect waves-purple btn-large  orange lighten-1 answer" onclick= "answerClient(5)"><i class="material-icons left">play_arrow</i>Answer 5</a>
              <a class="waves-effect waves-purple btn-large  orange lighten-1 answer" onclick= "answerClient(6)"><i class="material-icons left">play_arrow</i>Answer 6</a>
              <a class="waves-effect waves-purple btn-large  orange lighten-1 answer" onclick= "answerClient(7)"><i class="material-icons left">play_arrow</i>Answer 7</a>
              <a class="waves-effect waves-purple btn-large  orange lighten-1 answer" onclick= "answerClient(8)"><i class="material-icons left">play_arrow</i>Answer 8</a>
              <a class="waves-effect waves-purple btn-large  orange lighten-1 answer" onclick= "answerClient(9)"><i class="material-icons left">play_arrow</i>Answer 9</a>
            </div>
          </div>
          <div class="divider"></div>
          <div class="row">
            <div class="col s12 center">
              <a id="stopAll" class="waves-effect waves-light btn-large red disabled" onclick= "stopAllClient()"><i class="material-icons left">stop</i>Stop Answer</a>
            </div>
          </div>
          <div class="divider"></div>
        </div>
      </div>
    </div>
<script>

//hide divs cause css is giving me a hard time
$('#controls').hide();
$('#connectMsg').hide();


//make click events also touch events
var forward = $('#forward');
var back = $('#back');
var rotateLeft = $('#rotateLeft');
var rotateRight = $('#rotateRight');


function touchEvents (button, move1) {
  button.on("touchstart", move1);
  button.on("touchend", stopMove);
}

touchEvents(forward, moveForward);
touchEvents(forward, moveForward);
touchEvents(back, moveBackward);
touchEvents(rotateLeft, leftRotation);
touchEvents(rotateRight, rightRotation);
//
//Initialize socket.io and connect to localhost robot.
var socket = io.connect('http://192.168.10.103:8080');

socket.on('messages', function(data) {
      console.log(data);
});
socket.on('messages', function(data){
if (data == 'Aborted!') {
  $("#stopAll").addClass('disabled');
} else if (data.includes("Requesting answer")) {
  $("#stopAll").removeClass('disabled');
  } else if (data == "Done!") {
    $("#stopAll").addClass('disabled');
    $(".answer").removeClass('disabled');
  }
});

socket.on('messages', function(data){
if (data == 'Roombokita Session Connected!') {
  $("#tab2").removeClass('disabled');
  $("#connect").addClass('disabled');
  $('#controls').fadeIn('fast');
  $('#status').html('Connected');
  $('#redLight').fadeOut('fast');
  } else if (data == "Disconnected!") {
    $("#connect").removeClass('disabled');
  }
});

socket.io.on('connect_error', function(err) {
  $("#connect").addClass('disabled');
  $('#connectMsg').fadeIn('slow');
  $('#status').html('Disconnected');
  $('#redLight').fadeIn('slow');
  $('#controls').hide();
  $("#tab2").addClass('disabled');
});

function clientConnect() {
  socket.emit('start', 'Connecting...')
}

function moveForward () {
  socket.emit('move', 'Requesting action...')
}

function stopMove () {
  socket.emit('stop', 'Requesting action...')
}

function moveBackward () {
  socket.emit('back', 'Requesting action...')
}

function rightRotation () {
  socket.emit('turn_right', 'Requesting action...')
}

function leftRotation () {
  socket.emit('turn_left', 'Requesting action...')
}

function answerClient(number) {
  socket.emit('play_answer'+ number +'', 'Requesting answer' + number + '...');
  $("#stopAll").removeClass('disabled');
  $('.answer').addClass('disabled');
}

function stopAllClient() {
  socket.emit('stopAll', 'Stopping All...');
}


</script>
</body>
</html>
